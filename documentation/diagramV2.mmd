%%{init: {"theme":"dark"}}%%
graph TB
    %% Users and Frontend
    U1[ðŸ‘¤ User 1] --> FE[ðŸŒ Frontend\PHP HTML JS]
    U2[ðŸ‘¤ User 2] --> FE
    U3[ðŸ‘¤ User 3] --> FE
    
    %% Frontend connections
    FE -->|HTTPS\Login Profile etc| API[ðŸ”§ API Server\FastAPI Python]
    FE -->|WSS Secure WebSocket\Real-time chat| WS[ðŸ’¬ WebSocket Chat Server\Python WebSockets]
    
    %% Backend communication
    WS -->|Local JWT Validation\Shared Secret Key| WS_Auth[ðŸ›¡ï¸ Auth Logic]
    WS_Auth -->|Optional User Data Request| API
    API -->|Database Ops| DB[(ðŸ—„ï¸ Database\Users, Messages)]
    WS -->|Store Messages| API

    %% Data flow annotations
    FE -.->|User logs in| API
    API -.->|Returns JWT token| FE
    FE -.->|Connect to chat with JWT| WS
    WS -.->|Validate token locally| WS_Auth
    WS_Auth -.->|If needed, request user data| API
    WS -.->|Store chat messages via API| API
    WS -.->|Broadcast messages to connected users| WS

%% Styling
    classDef frontend fill:#0288d1,color:#ffffff
    classDef api fill:#7b1fa2,color:#ffffff
    classDef websocket fill:#388e3c,color:#ffffff
    classDef database fill:#f57c00,color:#ffffff
    classDef user fill:#c62828,color:#ffffff

    class FE frontend
    class API api
    class WS websocket
    class DB database
    class U1,U2,U3 user